<div class="container">
  <h2 class="center-content">Wybierz departament</h2>
  <div class="departments-grid">
    <mat-card *ngFor="let department of dataService.departments"
              (click)="selectDepartment(department)"
              [ngClass]="{'selected': selectedDepartment === department}"
              class="department-tile">
      <h3>{{ department.name }}</h3>
    </mat-card>
  </div>

  <div *ngIf="selectedDepartment" class="center-content">
    <h3>Wybierz cel</h3>
    <mat-form-field appearance="fill" class="goal-select">
      <mat-label>Cel</mat-label>
      <mat-select [(ngModel)]="selectedGoal" (selectionChange)="selectGoal($event.value)">
        <mat-option *ngFor="let goal of selectedDepartment.goals" [value]="goal">
          {{ goal.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <div class="buttons">
      <button mat-raised-button color="primary" [routerLink]="'/custom-goal'">
        Dodaj swój cel
      </button>
      <button mat-raised-button color="primary" [routerLink]="'/tasks'">
        Przejdź do tabeli
      </button>
    </div>
  </div>

  <div *ngIf="selectedGoal">
    <table mat-table [dataSource]="selectedGoal.metrics" class="mat-elevation-z8">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nazwa i sposób obliczenia miernika (algorytm)</th>
        <td mat-cell *matCellDef="let metric">
          <span matTooltip="{{ metric.description }}" matTooltipPosition="above">
            {{ metric.name }}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="level">
        <th mat-header-cell *matHeaderCellDef>Planowana wartość do osiągnięcia na koniec 2025 r.</th>
        <td mat-cell *matCellDef="let metric">
          <textarea matInput [(ngModel)]="metric.level" placeholder="Wprowadź poziom"></textarea>
          <button mat-raised-button color="primary" (click)="saveLevel(metric.level)">Zapisz</button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['name', 'level']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['name', 'level']"></tr>
    </table>
  </div>
</div>

<!-- Wyświetlanie listy zadań -->
<div *ngIf="selectedGoal?.tasks && selectedGoal.tasks.length > 0">
  <h3>Najważniejsze zadania służące realizacji celu:</h3>
  <ul>
    <li *ngFor="let task of selectedGoal.tasks; let i = index">
       {{ task }}
      <button mat-icon-button color="warn" (click)="removeTask(i)">
        <mat-icon>delete</mat-icon>
      </button>
    </li>
  </ul>
</div>

<!-- Dodawanie nowego zadania -->
<div *ngIf="selectedGoal" class="new-task-container">
  <mat-form-field appearance="fill" class="new-task-input">
    <mat-label>Nowe zadanie</mat-label>
    <textarea matInput [(ngModel)]="customTask" placeholder="Wprowadź nowe zadanie"></textarea>
  </mat-form-field>
  <button mat-raised-button color="primary" (click)="addTask(customTask)">
    Dodaj zadanie
  </button>
</div>

<!-- Przyciski nawigacyjne -->
<div class="buttons">
  <button mat-raised-button color="accent" (click)="saveData()">Zapisz dane</button>
  <button mat-raised-button color="primary" [routerLink]="'/tasks'">Przejdź do tabeli</button>
  <button mat-raised-button color="accent" (click)="exportToExcel()">Eksportuj do Excela</button>
</div>


<style>
/* Kafelki 3D */
.departments-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  padding: 20px;
}

.department-tile {
  cursor: pointer;
  padding: 30px;
  text-align: center;
  border-radius: 15px;
  background: linear-gradient(145deg, #f0f0f0, #cacaca);
  box-shadow: 5px 5px 15px #bebebe, -5px -5px 15px #ffffff;
  transition: all 0.3s ease-in-out;
}

.department-tile:hover {
  transform: translateY(-8px);
  box-shadow: 8px 8px 20px #bebebe, -8px -8px 20px #ffffff;
}

.department-tile.selected {
  border: 2px solid #1976d2;
  box-shadow: inset 5px 5px 15px #bebebe, inset -5px -5px 15px #ffffff;
}

.department-tile h3 {
  font-size: 18px;
  font-weight: bold;
  color: #333;
}
</style>
